---
title: "Make Trip List from On-board Survey Data"
output: html_notebook
---

# Overhead
```{r overhead, include = FALSE}
packages_vector <- c("tidyverse",
                     "arrow")

need_to_install <-
  packages_vector[!(packages_vector %in% installed.packages()[, "Package"])]

if (length(need_to_install)) install.packages(need_to_install)

for (package in packages_vector) {
  library(package, character.only = TRUE)
}

```

# Remote I/O
```{r remote-io}
box_dir <- "../../data/external/mtc/"
interim_dir <- "../../data/interim/"

survey_file_name <- paste0(box_dir, "OBS_PopulationSim_Weights.Rdata")
output_file_name <- paste0(interim_dir, "onboard-survey-trip-list.feather")

```

# Parameters
```{r parameters}
```

# Data Reads
```{r data-reads}
load(survey_file_name)
survey_df <- onboard
remove(onboard)
```

# Reductions
```{r reductions}
output_df <- survey_df %>%
  filter(weekpart == "WEEKDAY") %>%
  select(Unique_ID,
         operator,
         route,
         orig_maz,
         dest_maz,
         day_part,
         period,
         access_mode,
         egress_mode,
         local_bus_in_path = usedLB,
         commuter_rail_in_path = usedCR,
         heavy_rail_in_path = usedHR,
         express_bus_in_path = usedEB,
         light_rail_in_path = usedLR,
         ferry_in_path = usedFR,
         first_board_tech,
         last_alight_tech,
         boardings,
         boarding_weight = final_boardWeight_2015,
         trip_weight = final_tripWeight_2015) 

sum(filter(output_df, local_bus_in_path == 1)$boarding_weight)
sum(filter(output_df, express_bus_in_path == 1)$boarding_weight)
sum(filter(output_df, light_rail_in_path == 1)$boarding_weight)
sum(filter(output_df, ferry_in_path == 1)$boarding_weight)
sum(filter(output_df, heavy_rail_in_path == 1)$boarding_weight)
sum(filter(output_df, commuter_rail_in_path == 1)$boarding_weight)
sum(output_df$boarding_weight)
```

# Write to Disk
```{r data-write}
write_feather(output_df, output_file_name)
```


